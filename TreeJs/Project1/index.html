<!DOCTYPE html>
<html>
	<head>
		<title> Project 1 Tree js</title>
		<meta content="text/html" http-equiv="content-type" />
		<script src="../source/three.js"></script>
		<script src="js/curves.js"></script>
		<script src="js/escena.js"></script>
		<script src="js/caja.js"></script>
		<script>
			
			var render; 
			var escena;
			var canvasWidth = 1300;
			var canvasHeight = 650;

			////
			var camera;
			var raycaster;
			var mouse;

			var objects = [];

			raycaster = new THREE.Raycaster();
			mouse = new THREE.Vector2();

			var close =  true;
			////

			function initScene(){
				render = new THREE.WebGLRenderer();
				render.setClearColor(0xFFFFFF, 1);
				render.setSize(canvasWidth,canvasHeight);
				document.getElementById("canvas").appendChild(render.domElement);

				escena = new Escena(render,canvasWidth,canvasHeight,objects);
				
				var puntos = [[0,0],[-7,-3],[0,-7],[5,-9]];
				var pControl = [1/3,2/3];
				var length = 1/300;

				//result = CURVES.InterpolationCurve(puntos,pControl,length);
			    //result = CURVES.HermiteCurve(puntos,length);
				result = CURVES.BezierCurve(puntos,length);

				//Obtengo camara de la escena
				camera = escena.getCamera();

				document.addEventListener( 'mousedown', onDocumentMouseDown, false );			    
			}

			function onDocumentMouseDown( event ) {

				event.preventDefault();

				mouse.x = ( event.clientX / render.domElement.clientWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / render.domElement.clientHeight ) * 2 + 1;

				raycaster.setFromCamera( mouse, camera );

				var intersects = raycaster.intersectObjects( objects );

				if ( intersects.length > 0 ) {
					var tapa = intersects[ 0 ].object;

					if(close){
						tapa.rotation.x += - Math.PI / 2;
						tapa.position.z += 3;
						close = false;
					}

					else{
						tapa.rotation.x +=  Math.PI / 2;
						tapa.position.z -= 3;											
						close = true;
					}
				}
			}

			
			function animarEscena(){

				var length = result.length;
				var tiempo = (Date.now() - lastTime)/1000;//Divido porque esta en miliseg y lo quiero en segundos
				if(tiempo > 0){
					escena.animarCamara(result);
					escena.renderScene();
				}
				lastTime=Date.now();
    			setTimeout(animarEscena,1000/80) //1.6 60 frames por segundo
			}

			function initWebGl()
			{
				initScene();
				//renderScene();
				lastTime = Date.now();
				animarEscena();
			}
		</script>
	</head>
	<body onload="initWebGl()">
		<div id="canvas"></div>
	</body>
</html>